@model Danchi.Models.Mensaje

@{
    ViewBag.Title = "Detalle del Mensaje";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<style>
.msg-container {
    max-width: 900px;
    margin: 2.5rem auto;
    background: #fff;
    border-radius: 1.3rem;
    box-shadow: 0 4px 24px #ebb3b370, 0 1.5px 12px #f8b6b938;
    padding: 2.2rem 2rem 2rem 2rem;
}
.msg-title {
    color: #8a6d6d;
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1.1rem;
    text-align: center;
}
.msg-info {
    font-size: 1.06rem;
    margin-bottom: 1.3rem;
}
.msg-block {
    background: #f9f8f8;
    border-radius: 1rem;
    padding: 1.2rem 1.3rem;
    margin-bottom: 1.1rem;
    box-shadow: 0 1.5px 8px #ffb6b920;
}
.msg-label { font-weight: 600; color: #ae3b62; }
.msg-msg {
    background: #fff;
    border: 1.5px solid #ead8e4;
    border-radius: 1rem;
    padding: 0.8rem 1rem;
    font-size: 1.04rem;
    color: #7c7474;
    margin-bottom: 1rem;
    min-height: 50px;
}
.msg-respuesta-item {
    background: #ffe3ea;
    border-radius: .7rem;
    padding: 0.9rem 1rem;
    margin-bottom: .8rem;
    box-shadow: 0 1.5px 8px #ffb6b910;
}
.msg-respuesta-item strong { color: #ae3b62; }
.btn-rosa {
    background: linear-gradient(45deg, #ff7b9b 60%, #ebb3b3 100%);
    color: #fff !important;
    font-weight: 700;
    border-radius: 1.1rem;
    border: none;
    padding: 0.6rem 1.7rem;
    font-size: 1.05rem;
    box-shadow: 0 1.5px 10px #ffb6b933;
    transition: background 0.2s;
    margin-right: .7rem;
}
.btn-rosa:hover {
    background: linear-gradient(45deg, #ce466d 60%, #ebb3b3 100%);
    color: #fff !important;
}
@@media (max-width: 800px) {
    .msg-container { padding: 1rem 0.4rem; }
    .msg-title { font-size: 1.12rem; }
}
</style>

<div class="msg-container">
    <div class="msg-title">Detalle del Mensaje</div>
    <div class="msg-info">
        <span class="msg-label">De:</span> @Model.Emisor.Correo<br>
        <span class="msg-label">Para:</span> @Model.Receptor.Correo<br>
        <span class="msg-label">Asunto:</span> @Model.Asunto<br>
        <span class="msg-label">Fecha:</span> @Model.FechaEnvio.ToString("dd/MM/yyyy HH:mm")
    </div>

    <div class="msg-block">
        <div class="msg-label">Mensaje:</div>
        <div class="msg-msg">@Model.Descripcion</div>
        @if (!string.IsNullOrEmpty(Model.ArchivoAdjunto))
        {
            <div style="margin-bottom:1rem;">
                <span class="msg-label">Archivo adjunto:</span>
                @Html.ActionLink("Descargar", "DescargarArchivo", new { id = Model.IdMensaje }, new { @class = "btn-rosa", style = "padding: 0.35rem 1.3rem; font-size:0.98rem;" })
            </div>
        }
    </div>

    <div class="msg-block">
        <div class="msg-label" style="margin-bottom:0.5rem;">Mensajes:</div>
        @if (Model.Respuestas != null && Model.Respuestas.Any())
        {
            foreach (var respuesta in Model.Respuestas.OrderBy(r => r.FechaEnvio))
            {
                <div class="msg-respuesta-item">
                    <p style="margin-bottom:0.2rem;">
                        <strong>@respuesta.Emisor.Correo</strong>
                        <span style="color:#888;">(@respuesta.FechaEnvio.ToString("dd/MM/yyyy HH:mm"))</span>
                    </p>
                    <div>@respuesta.Descripcion</div>
                </div>
            }
        }
        else
        {
            <div class="text-muted">Sin respuestas.</div>
        }
    </div>

    <div class="msg-block">
        <div class="msg-label" style="margin-bottom:0.6rem;">Responder:</div>
        @using (Html.BeginForm("Create", "Mensajes", FormMethod.Post))
        {
            @Html.AntiForgeryToken()
            @Html.Hidden("IdReceptor", Model.IdEmisor)
            @Html.Hidden("MensajePadreId", Model.IdMensaje)
            @Html.Hidden("Asunto", "RE: " + Model.Asunto)

            <div>
                @Html.TextArea("Descripcion", null, new { @class = "msg-msg", rows = 4, placeholder = "Escribe tu respuesta..." })
            </div>
            <button type="submit" class="btn-rosa">Enviar respuesta</button>
        }
    </div>
    <div style="margin-top:1rem;">
        @Html.ActionLink("← Volver a la lista", "Index", null, new { style = "color:#ae3b62; font-weight:600; text-decoration:none;" })
    </div>
</div>
